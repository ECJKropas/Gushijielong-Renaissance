{% extends "admin_base.html" %}

{% block title %}ç”¨æˆ·ç®¡ç† - æ•…äº‹æ¥é¾™ç½‘ç«™{% endblock %}

{% block content %}
    <div class="admin-header">
        <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
        <p>ç®¡ç†ç³»ç»Ÿä¸­çš„æ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬æƒé™è®¾ç½®å’Œç”¨æˆ·ä¿¡æ¯ç®¡ç†ã€‚</p>
    </div>
    
    <div class="admin-stats" style="margin-bottom: 2rem;">
        <div class="stat-card">
            <h4>æ€»ç”¨æˆ·æ•°</h4>
            <div class="stat-number">{{ users|length }}</div>
        </div>
        <div class="stat-card">
            <h4>ç®¡ç†å‘˜æ•°</h4>
            <div class="stat-number">{{ users|selectattr("role", "equalto", "admin")|list|length }}</div>
        </div>
        <div class="stat-card">
            <h4>æ™®é€šç”¨æˆ·æ•°</h4>
            <div class="stat-number">{{ users|selectattr("role", "equalto", "user")|list|length }}</div>
        </div>
    </div>
    
    {% if users %}
        <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1.5rem; color: #2d3748;">ğŸ“‹ ç”¨æˆ·åˆ—è¡¨</h3>
            
            <div style="overflow-x: auto;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ç”¨æˆ·å</th>
                            <th>é‚®ç®±</th>
                            <th>è§’è‰²</th>
                            <th>æ³¨å†Œæ—¶é—´</th>
                            <th>æ´»è·ƒæ¬¡æ•°</th>
                            <th>ç§¯åˆ†</th>
                            <th>ä¿¡ç”¨åˆ†</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td><strong>{{ user.id }}</strong></td>
                            <td>
                                <strong style="color: #2d3748;">{{ user.username }}</strong>
                                {% if user.username == current_user.username %}
                                    <span style="color: #667eea; font-size: 0.8rem;">(å½“å‰ç”¨æˆ·)</span>
                                {% endif %}
                            </td>
                            <td style="color: #4a5568;">{{ user.email }}</td>
                            <td>
                                <span class="role-badge role-{{ user.role }}">
                                    {{ "ç®¡ç†å‘˜" if user.role == "admin" else "ç”¨æˆ·" }}
                                </span>
                            </td>
                            <td style="color: #718096; font-size: 0.9rem;">
                                {{ user.registered_at.strftime('%Y-%m-%d %H:%M') }}
                            </td>
                            <td>
                                <span style="color: #48bb78; font-weight: 600;">{{ user.active_count }}</span>
                            </td>
                            <td>
                                <span style="color: #f6ad55; font-weight: 600;">{{ user.points }}</span>
                            </td>
                            <td>
                                <span style="color: {% if user.credit >= 80 %}#48bb78{% elif user.credit >= 60 %}#f6ad55{% else %}#f56565{% endif %}; font-weight: 600;">
                                    {{ "%.1f"|format(user.credit) }}
                                </span>
                            </td>
                            <td>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    {% if user.role == "user" %}
                                        <form action="/admin/make_admin/{{ user.id }}" method="post" style="display: inline;">
                                            <button type="submit" class="btn-admin btn-admin-success" 
                                                    onclick="return confirm('ç¡®å®šè¦å°† {{ user.username }} è®¾ç½®ä¸ºç®¡ç†å‘˜å—ï¼Ÿ')"
                                                    title="è®¾ç½®ä¸ºç®¡ç†å‘˜">
                                                ğŸ‘‘ è®¾ç®¡
                                            </button>
                                        </form>
                                    {% else %}
                                        {% if user.username != current_user.username %}
                                            <form action="/admin/remove_admin/{{ user.id }}" method="post" style="display: inline;">
                                                <button type="submit" class="btn-admin btn-admin-primary" 
                                                        onclick="return confirm('ç¡®å®šè¦ç§»é™¤ {{ user.username }} çš„ç®¡ç†å‘˜æƒé™å—ï¼Ÿ')"
                                                        title="ç§»é™¤ç®¡ç†å‘˜æƒé™">
                                                    ğŸ”“ ç§»ç®¡
                                                </button>
                                            </form>
                                        {% endif %}
                                    {% endif %}
                                    
                                    {% if user.username != current_user.username %}
                                        <form action="/admin/delete/user/{{ user.id }}" method="post" style="display: inline;">
                                            <button type="submit" class="btn-admin btn-admin-danger" 
                                                    onclick="return confirm('ç¡®å®šè¦åˆ é™¤ç”¨æˆ· {{ user.username }} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')"
                                                    title="åˆ é™¤ç”¨æˆ·">
                                                ğŸ—‘ï¸ åˆ é™¤
                                            </button>
                                        </form>
                                    {% else %}
                                        <button class="btn-admin" disabled title="ä¸èƒ½åˆ é™¤å½“å‰ç”¨æˆ·" style="background: #cbd5e0; color: white;">
                                            ğŸš« åˆ é™¤
                                        </button>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% else %}
        <div style="background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ‘¥</div>
            <h3 style="color: #4a5568; margin-bottom: 1rem;">æš‚æ— ç”¨æˆ·</h3>
            <p style="color: #718096;">ç³»ç»Ÿä¸­è¿˜æ²¡æœ‰ä»»ä½•ç”¨æˆ·æ³¨å†Œã€‚</p>
        </div>
    {% endif %}
    
    <div style="background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); padding: 2rem; border-radius: 12px; margin-top: 2rem;">
        <h4 style="color: #2d3748; margin-bottom: 1rem;">ğŸ’¡ ç”¨æˆ·ç®¡ç†æç¤º</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div style="background: white; padding: 1rem; border-radius: 8px;">
                <h5 style="color: #667eea; margin-bottom: 0.5rem;">ğŸ‘‘ ç®¡ç†å‘˜æƒé™</h5>
                <p style="color: #4a5568; font-size: 0.9rem;">ç®¡ç†å‘˜æ‹¥æœ‰ç³»ç»Ÿçš„æ‰€æœ‰ç®¡ç†æƒé™ï¼Œè¯·è°¨æ…åˆ†é…ã€‚</p>
            </div>
            <div style="background: white; padding: 1rem; border-radius: 8px;">
                <h5 style="color: #48bb78; margin-bottom: 0.5rem;">ğŸ“Š ç”¨æˆ·ç»Ÿè®¡</h5>
                <p style="color: #4a5568; font-size: 0.9rem;">æ´»è·ƒæ¬¡æ•°åæ˜ ç”¨æˆ·å‚ä¸åº¦ï¼Œç§¯åˆ†å’Œä¿¡ç”¨åˆ†ç”¨äºç”¨æˆ·è¯„çº§ã€‚</p>
            </div>
            <div style="background: white; padding: 1rem; border-radius: 8px;">
                <h5 style="color: #f6ad55; margin-bottom: 0.5rem;">âš ï¸ åˆ é™¤ç”¨æˆ·</h5>
                <p style="color: #4a5568; font-size: 0.9rem;">åˆ é™¤ç”¨æˆ·å°†åŒæ—¶åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰å†…å®¹ï¼Œæ“ä½œä¸å¯æ¢å¤ã€‚</p>
            </div>
        </div>
    </div>
{% endblock %}