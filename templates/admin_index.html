{% extends "admin_base.html" %}

{% block title %}ç®¡ç†ä»ªè¡¨ç›˜ - æ•…äº‹æ¥é¾™ç½‘ç«™{% endblock %}

{% block content %}
    <div class="admin-header">
        <h2>ğŸ“Š ç®¡ç†ä»ªè¡¨ç›˜</h2>
        <p>æ¬¢è¿å›æ¥ï¼Œ{{ current_user.username }}ï¼è¿™é‡Œæ˜¯ç³»ç»Ÿçš„æ•´ä½“æ¦‚è§ˆã€‚</p>
    </div>
    
    <div class="admin-stats">
        <div class="stat-card">
            <h4>æ€»ç”¨æˆ·æ•°</h4>
            <div class="stat-number">{{ stats.total_users }}</div>
        </div>
        <div class="stat-card">
            <h4>æ´»è·ƒç”¨æˆ·æ•°</h4>
            <div class="stat-number">{{ stats.active_users }}</div>
        </div>
        <div class="stat-card">
            <h4>æ€»æ•…äº‹æ•°</h4>
            <div class="stat-number">{{ stats.total_stories }}</div>
        </div>
        <div class="stat-card">
            <h4>æ€»ç« èŠ‚æ•°</h4>
            <div class="stat-number">{{ stats.total_chapters }}</div>
        </div>
        <div class="stat-card">
            <h4>æ€»è®¨è®ºæ•°</h4>
            <div class="stat-number">{{ stats.total_discussions }}</div>
        </div>
        <div class="stat-card">
            <h4>æ€»è¯„è®ºæ•°</h4>
            <div class="stat-number">{{ stats.total_comments }}</div>
        </div>
    </div>
    
    <div class="recent-activity">
        <h3>ğŸ”„ æœ€è¿‘æ´»åŠ¨</h3>
        
        <div class="activity-section">
            <h4>ğŸ‘¥ æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·</h4>
            {% if stats.recent_users %}
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ç”¨æˆ·å</th>
                            <th>é‚®ç®±</th>
                            <th>è§’è‰²</th>
                            <th>æ³¨å†Œæ—¶é—´</th>
                            <th>ç§¯åˆ†</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in stats.recent_users %}
                        <tr>
                            <td>
                                <strong>{{ user.username }}</strong>
                            </td>
                            <td>{{ user.email }}</td>
                            <td>
                                <span class="role-badge role-{{ user.role }}">
                                    {{ "ç®¡ç†å‘˜" if user.role == "admin" else "ç”¨æˆ·" }}
                                </span>
                            </td>
                            <td>{{ user.registered_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>
                                <span style="color: #48bb78; font-weight: 600;">{{ user.points }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div style="text-align: center; padding: 2rem; color: #718096;">
                    <p>æš‚æ— æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·</p>
                </div>
            {% endif %}
        </div>
        
        <div class="activity-section">
            <h4>ğŸ“š æœ€è¿‘åˆ›å»ºçš„æ•…äº‹</h4>
            {% if stats.recent_stories %}
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>æ ‡é¢˜</th>
                            <th>ä½œè€…</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for story in stats.recent_stories %}
                        <tr>
                            <td>
                                <a href="/stories/{{ story.id }}" target="_blank" style="color: #667eea; font-weight: 600;">
                                    {{ story.title }}
                                </a>
                            </td>
                            <td>{{ story.author.username }}</td>
                            <td>{{ story.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>
                                <a href="/stories/{{ story.id }}" target="_blank" class="btn-admin btn-admin-primary">
                                    æŸ¥çœ‹
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div style="text-align: center; padding: 2rem; color: #718096;">
                    <p>æš‚æ— æœ€è¿‘åˆ›å»ºçš„æ•…äº‹</p>
                </div>
            {% endif %}
        </div>
        
        <div class="activity-section">
            <h4>ğŸ’¬ æœ€è¿‘åˆ›å»ºçš„è®¨è®º</h4>
            {% if stats.recent_discussions %}
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>æ ‡é¢˜</th>
                            <th>ä½œè€…</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for discussion in stats.recent_discussions %}
                        <tr>
                            <td>
                                <a href="/discussions/{{ discussion.id }}" target="_blank" style="color: #667eea; font-weight: 600;">
                                    {{ discussion.title }}
                                </a>
                            </td>
                            <td>{{ discussion.author_name }}</td>
                            <td>{{ discussion.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>
                                <a href="/discussions/{{ discussion.id }}" target="_blank" class="btn-admin btn-admin-primary">
                                    æŸ¥çœ‹
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div style="text-align: center; padding: 2rem; color: #718096;">
                    <p>æš‚æ— æœ€è¿‘åˆ›å»ºçš„è®¨è®º</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div style="background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); padding: 2rem; border-radius: 12px; margin-top: 2rem;">
        <h4 style="color: #2d3748; margin-bottom: 1rem;">ğŸš€ å¿«é€Ÿæ“ä½œ</h4>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <a href="/admin/users" class="btn-admin btn-admin-primary">ğŸ‘¥ ç®¡ç†ç”¨æˆ·</a>
            <a href="/admin/stories" class="btn-admin btn-admin-primary">ğŸ“š ç®¡ç†æ•…äº‹</a>
            <a href="/admin/discussions" class="btn-admin btn-admin-primary">ğŸ’¬ ç®¡ç†è®¨è®º</a>
            <a href="/" target="_blank" class="btn-admin btn-admin-success">ğŸŒ æŸ¥çœ‹ç½‘ç«™</a>
        </div>
    </div>
{% endblock %}